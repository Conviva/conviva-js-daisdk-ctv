/*! (C) 2025 Conviva, Inc. All rights reserved. Confidential and proprietary. */
((o,n)=>{var e;"function"==typeof define&&define.amd?define(n):("object"==typeof exports||"object"==typeof module&&module.exports)&&(module.exports=n()),void 0!==o&&o&&(void 0!==o.Conviva&&o.Conviva?o.Conviva.AdProxyMonitor||o.ConvivaModuleLoading||(e=n(),o.ConvivaModuleLoading=!0,o.Conviva.AdProxyMonitor=e.AdProxyMonitor,o.Conviva.Impl.GoogleDaiProxy=e.Impl.GoogleDaiProxy,delete o.ConvivaModuleLoading):o.ConvivaModule||o.ConvivaModuleLoading||(o.ConvivaModuleLoading=!0,o.ConvivaModule=n(),delete o.ConvivaModuleLoading))})(this,function(){var i={};function o(o,n,e,d,l){var t,p=this,i="CONVIVA",u=[google.ima.ctv.dai.api.StreamEvent.Type.AD_BREAK_STARTED,google.ima.ctv.dai.api.StreamEvent.Type.AD_BREAK_ENDED,google.ima.ctv.dai.api.StreamEvent.Type.SKIPPED,google.ima.ctv.dai.api.StreamEvent.Type.AD_PROGRESS,google.ima.ctv.dai.api.StreamEvent.Type.COMPLETE,google.ima.ctv.dai.api.StreamEvent.Type.FIRST_QUARTILE,google.ima.ctv.dai.api.StreamEvent.Type.LOADED,google.ima.ctv.dai.api.StreamEvent.Type.MIDPOINT,google.ima.ctv.dai.api.StreamEvent.Type.STARTED,google.ima.ctv.dai.api.StreamEvent.Type.THIRD_QUARTILE,google.ima.ctv.dai.api.StreamEvent.Type.ERROR,google.ima.ctv.dai.api.StreamEvent.Type.AD_PERIOD_STARTED,google.ima.ctv.dai.api.StreamEvent.Type.AD_PERIOD_ENDED],r=1,g={};function f(o){switch(o.type!==google.ima.ctv.dai.api.StreamEvent.Type.AD_PROGRESS&&k("onStreamManagerEvent event="+o.type),o.type){case google.ima.ctv.dai.api.StreamEvent.Type.AD_BREAK_ENDED:p.o||c(),p.o&&p.l&&(p.o.reportAdPlayerEvent(d.Constants.Events.USER_WAIT_ENDED),p.l=!1,p.t.getVideoAnalytics().setAdAnalytics(p.o));break;case google.ima.ctv.dai.api.StreamEvent.Type.AD_BREAK_STARTED:a(o),s();break;case google.ima.ctv.dai.api.StreamEvent.Type.LOADED:p.i=o.getStreamData().url,p.u=o.getStreamData().streamId;break;case google.ima.ctv.dai.api.StreamEvent.Type.STARTED:a(o),s(),y("start",o);break;case google.ima.ctv.dai.api.StreamEvent.Type.FIRST_QUARTILE:a(o),s(),y("firstQuartile",o);break;case google.ima.ctv.dai.api.StreamEvent.Type.MIDPOINT:a(o),s(),y("midpoint",o);break;case google.ima.ctv.dai.api.StreamEvent.Type.THIRD_QUARTILE:a(o),s(),y("thirdQuartile",o);break;case google.ima.ctv.dai.api.StreamEvent.Type.AD_PROGRESS:break;case google.ima.ctv.dai.api.StreamEvent.Type.SKIPPED:p.g&&p.t&&(p.t.reportAdSkipped(),p.t.getVideoAnalytics().setAdAnalytics(null),p.g=!1);break;case google.ima.ctv.dai.api.StreamEvent.Type.COMPLETE:y("complete",o),p.g&&p.t&&(p.t.reportAdEnded(),p.g=!1,p.t.getVideoAnalytics().setAdAnalytics(null));break;case google.ima.ctv.dai.api.StreamEvent.Type.ERROR:var n=o,e=null;n.getStreamData()&&(e=n.getStreamData().errorMessage),p.t&&(e=e||"Ad Failed",p.g||(b(n.getAd(),!1,p.t),(l={})[d.Constants.ASSET_NAME]="Ad Failed",p.t.setAdInfo(l)),p.t.reportAdFailed(e),p.t.getVideoAnalytics().setAdAnalytics(null),p.g=!1),p.o&&(e=e||"Slate Failed",b(n.getAd(),!0,p.o),p.o.reportAdFailed(e),p.o.getVideoAnalytics().setAdAnalytics(null),p.o.release(),p.o=null);break;case google.ima.ctv.dai.api.StreamEvent.Type.AD_PERIOD_STARTED:a(o),l=o,p.t&&p.t.getVideoAnalytics()&&(p.o||(p.o=d.Analytics.buildAdAnalytics(p.t.getVideoAnalytics()),p.t.getVideoAnalytics().setAdAnalytics(p.o),p.o.reportAdStarted(b(l.getAd(),!0,p.o)),p.o.reportAdMetric(d.Constants.Playback.PLAYER_STATE,d.Constants.PlayerState.PLAYING,i,r)));break;case google.ima.ctv.dai.api.StreamEvent.Type.AD_PERIOD_ENDED:c(),p.o&&(p.o.reportAdEnded(),p.o.getVideoAnalytics().setAdAnalytics(null),p.o.release(),p.o=null)}var l}function a(o){var n,e;!p.p&&p.t&&(e=n=null,"function"==typeof o.getAdPodInfo&&void 0!==o.getAdPodInfo()&&o.getAdPodInfo()&&(n=v(o.getAdPodInfo(),p.t.getAdPlayerMonitor().getContentMetadata()),"function"==typeof o.getAdPodInfo().getMaxDuration)&&"number"==typeof o.getAdPodInfo().getMaxDuration()&&(e=o.getAd().getAdPodInfo().getMaxDuration()),o={},n&&(o[d.Constants.POD_POSITION]=n),e&&(o[d.Constants.POD_DURATION]=e),o[d.Constants.POD_INDEX]=p.v,p.t.getVideoAnalytics().reportAdBreakStarted(d.Constants.AdType.SERVER_SIDE,d.Constants.AdPlayer.CONTENT,o),p.p=!0)}function c(){p.p&&p.t&&(p.p=!1,p.t.getVideoAnalytics().reportAdBreakEnded(),p.v++)}function s(){p.p&&p.o&&!p.l&&(p.l=!0,p.o.reportAdPlayerEvent(d.Constants.Events.USER_WAIT_STARTED),p.t.getVideoAnalytics().setAdAnalytics(null))}function y(o,n){!p.g&&p.t&&(p.t.getVideoAnalytics().setAdAnalytics(p.t),p.t.reportAdStarted(b(n.getAd(),!1,p.t,o)),p.t.reportAdMetric(d.Constants.Playback.PLAYER_STATE,d.Constants.PlayerState.PLAYING,i,r),p.g=!0)}function v(o,n){var e="Mid-roll";return e=n[d.Constants.IS_LIVE]===d.Constants.StreamType.VOD&&"function"==typeof o.getPodIndex&&"number"==typeof o.getPodIndex()?0===(n=o.getPodIndex())?"Pre-roll":-1===n?"Post-roll":"Mid-roll":e}function b(o,n,e,l){var t,i,u,r,g,f,a,c,s;e&&(r=o,g=t={},f=n,(a=e)&&(c=a.getAdPlayerMonitor().getContentMetadata(),a=a.getPlayerMonitor().getContentMetadata(),f?((s=a.assetName)&&(g["c3.ad.videoAssetName"]=s),g[d.Constants.ASSET_NAME]="slate",g[d.Constants.IS_LIVE]=d.Constants.StreamType.LIVE):r&&(c&&c.assetName||(g[d.Constants.ASSET_NAME]=r.getTitle()),c&&0<=c.duration||(g[d.Constants.DURATION]=r.getDuration())),a&&(f||c&&c.streamType!==d.Constants.StreamType.UNKNOWN||(s=a.streamType)!==d.Constants.StreamType.UNKNOWN&&(g[d.Constants.IS_LIVE]=s),c&&c.defaultResource||(r=a.defaultResource)&&(g[d.Constants.DEFAULT_RESOURCE]=r),c&&-1<=c.encodedFrameRate||-1!==(f=a.encodedFrameRate)&&(g[d.Constants.ENCODED_FRAMERATE]=f)),c&&c.streamUrl||p.i&&(g[d.Constants.STREAM_URL]=p.i)),s=o,r=n,a=l,(f=t)["c3.ad.adStitcher"]="Google DAI",f["c3.ad.technology"]=d.Constants.AdType.SERVER_SIDE,f["c3.ad.adManagerName"]="Google IMA SDK",f["c3.ad.id"]="NA",f["c3.ad.podIndex"]="",f["c3.ad.system"]="NA",f["c3.ad.mediaFileApiFramework"]="NA",f["c3.ad.firstAdSystem"]="NA",f["c3.ad.firstAdId"]="NA",f["c3.ad.firstCreativeId"]="NA",f[d.Constants.IS_LIVE]===d.Constants.StreamType.LIVE&&(f["c3.ad.position"]="Mid-roll"),f["c3.ad.isSlate"]=""+r,a&&(f["c3.ad.sessionStartEvent"]=a),p.u&&(f["c3.ad.streamId"]=p.u),s&&("function"==typeof s.getAdId&&"string"==typeof s.getAdId()&&""!==s.getAdId()&&(f["c3.ad.id"]=s.getAdId()),"function"==typeof s.getAdSystem&&"string"==typeof s.getAdSystem()&&""!==s.getAdSystem()&&(f["c3.ad.system"]=s.getAdSystem()),"function"==typeof s.getApiFramework&&"string"==typeof s.getApiFramework()&&""!==s.getApiFramework()&&(f["c3.ad.mediaFileApiFramework"]=s.getApiFramework()),"function"==typeof s.getCreativeId&&"string"==typeof s.getCreativeId()&&""!==s.getCreativeId()&&(f["c3.ad.creativeId"]=s.getCreativeId()),"function"==typeof s.getAdvertiserName&&"string"==typeof s.getAdvertiserName()&&""!==s.getAdvertiserName()&&(f["c3.ad.advertiser"]=s.getAdvertiserName()),"function"==typeof s.getAdPodInfo&&void 0!==s.getAdPodInfo()&&s.getAdPodInfo()&&("function"==typeof s.getAdPodInfo().getAdPosition&&"number"==typeof s.getAdPodInfo().getAdPosition()&&(f["c3.ad.sequence"]=""+s.getAdPodInfo().getAdPosition()),"function"==typeof s.getAdPodInfo().getPodIndex&&"number"==typeof s.getAdPodInfo().getPodIndex()&&(f["c3.ad.podIndex"]=""+s.getAdPodInfo().getPodIndex()),f["c3.ad.position"]||(f["c3.ad.position"]=v(s.getAdPodInfo(),f))),a=s.getWrapperAdIds()&&0!==s.getWrapperAdIds().length?(r=s.getWrapperAdIds().length,i=s.getWrapperAdSystems()[r-1],u=s.getWrapperAdIds()[r-1],s.getWrapperCreativeIds()[r-1]):(i=s.getAdSystem(),u=s.getAdId(),s.getCreativeId()),f["c3.ad.firstAdSystem"]=""+i,f["c3.ad.firstAdId"]=""+u,f["c3.ad.firstCreativeId"]=""+a,void 0!==s.getUniversalAdIds())&&s.getUniversalAdIds()&&0<s.getUniversalAdIds().length&&("string"==typeof s.getUniversalAdIds()[0].getAdIdRegistry()&&"unknown"!==s.getUniversalAdIds()[0].getAdIdRegistry()&&""!==s.getUniversalAdIds()[0].getAdIdRegistry()&&(f["c3.ad.univAdIdReg"]=s.getUniversalAdIds()[0].getAdIdRegistry()),"string"==typeof s.getUniversalAdIds()[0].getAdIdValue())&&"unknown"!==s.getUniversalAdIds()[0].getAdIdValue()&&""!==s.getUniversalAdIds()[0].getAdIdValue()&&(f["c3.ad.univAdIdVal"]=s.getUniversalAdIds()[0].getAdIdValue()),t[d.Constants.MODULE_NAME]="GD",t[d.Constants.MODULE_VERSION]="1.0.0",e.setAdInfo(t),(c={})[d.Constants.FRAMEWORK_NAME]="Google IMA SDK",e.setAdPlayerInfo(c))}function k(o){p.k&&p.k.log(o,d.SystemSettings.LogLevel.DEBUG)}g.ended=function(){k("onended event"),p.g&&p.t&&(p.t.reportAdEnded(),p.g=!1,p.t.getVideoAnalytics().setAdAnalytics(null))},g.error=function(){k("onerror event="+p.A.error.message),p.g&&p.t&&(p.t.reportAdFailed(p.A.error.message),p.t.getVideoAnalytics().setAdAnalytics(null),p.g=!1),p.o&&(p.o.reportAdFailed(p.A.error.message),p.o.getVideoAnalytics().setAdAnalytics(null),p.o.release(),p.o=null)},this.cleanup=function(){var o;!function(o){if(o)for(var n in g)o.removeEventListener(n,g[n].bind(this))}(p.A),(o=p.h)&&o.removeEventListener(u,f,!1),p.A=null,p.h=null,p.o=null,p.t=null,p.g=!1,p.m=null,p.M=null,p.A=null,p.p=!1,p.l=!1,p.N=-1,p.D=null,p.k=null,p.v=1,p.i=null,p.u=null},p.u=null,p.i=null,p.A=null,p.I=null,p.o=null,p.g=!1,p.G=!1,p.m={},p.M={},p.A=null,p.p=!1,p.N=-1,p.v=1,p.i=null,p.u=null,p.P=-1,p.S=-1,p.I=-1,p.D=l,p.h=o,p.t=e,p.k=p.D.buildLogger(),p.k.setModuleName("GoogleDAIProxy"),(t=p.h)&&u.forEach(function(o){t.addEventListener(o,f,!1)}),void 0!==n&&n&&(p.A=n[d.Constants.IMASDK_CONTENT_PLAYER],function(o){if(o)for(var n in g)o.addEventListener(n,g[n].bind(this))}(p.A))}return i.AdProxyMonitor={F:null,release:function(){this.F&&this.F.cleanup()},initConvivaDropIn:function(o,n,e,l,t){if(null!==o)return this.F=new i.Impl.GoogleDaiProxy(o,n,e,l,t),this.F;throw new Error("No Ad Manager proxy initialized")}},void 0!==i&&(i.Impl=i.Impl||{},i.Impl.GoogleDaiProxy=o),i});